<!DOCTYPE html>
<html>
<head>
  <title>Leaflet Quick Start Guide Example</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>

</head>
<body>

  <div class="col-lg-1 col-centered">
  <h1>Geotracking </h1>
</div>

<%# render map through rails gem %>
  <div id="map" style="width: 100%; height: 400px">
      <script>

      if (gon.exif.length == 0){
        var map = L.map('map').setView([51.92, 4.48], 14);
      }
      else{
        var last_element = gon.exif[gon.exif.length -1]
        var map = L.map('map').setView([last_element[0], last_element[1]], 14);
        }
    
    

    L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);



  //  L.marker([51.922138277777776, 4.483124222222222]).bindPopup('picture taken at 2016-04-09 01:06:15 +0200 by David').addTo(map);
    for (i=0; i<gon.exif.length; i++){
      L.marker([gon.exif[i][0],gon.exif[i][1]]).bindPopup("<p>"+gon.exif[i][2]+"</p><img src="+gon.exif[i][3]+">").addTo(map);
    }
    //L.marker([gon.exif[0][0], gon.exif[0][1]]).bindPopup('picture taken at 2016-04-09 01:06:15 +0200 by David').addTo(map);
  
    //L.marker([51.92,4.48])

    </script>
 </div>
  <%#= image_tag Proof.last.picture.url %>
    <section class="success" id="about">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2>Try it</h2>
                    <hr class="star-light">
                </div>
            </div>
            <div class="row">
                <div class="col-lg-4 col-lg-offset-2">
                    <p><%= form_for(@proof, html: {multipart: true}) do |f|%>
                        <%= f.file_field :picture, accept: 'image/jpeg,image/gif,image/png', required: 'required' %>
                       
                        <%= f.submit "Add to map", class: "btn btn-lg btn-outline"%><% end %></p>
                </div>
                <div class="col-lg-4">
                    <p>Make sure your camera app is saving GPS and timestamps.</p>
                </div>
                
            </div>
        </div>
    </section>
    <img src = <%= Proof.last.picture.url%> >
    
</body>
</html>

